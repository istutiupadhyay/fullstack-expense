<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--<link rel="stylesheet" href="style.css">-->
    <title>Document</title>
</head>
<body>
    <form id="addform" onsubmit="addExpense(event)">
        <h1>Expence Tracker</h1>

    <label for="expense">Choose expense-amount:</label><br>
    <input type="number" name="expenseamount"><br>
    <label for="description">Choose description:</label><br>
    <input type="text" name="description"><br>
    <label for="category">Choose a category:</label><br>
  <select id="category" name="category">
    <option value="rent">rent</option>
    <option value="drinks">drinks</option>
    <option value="food">food</option>
    <option value="fuel">Fuel</option>
    <option value="ticket">Ticket</option>
  </select><br><br><br>
    <input type="submit" value="Add expences"><br>
</form>
</div>
<ul id="listOfExpenses"></ul>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.1.2/axios.min.js" ></script>
<script>
  function addExpense(e){
    e.preventDefault();

    const obj = {
      expenseamount: e.target.expenseamount.value,
      description: e.target.description.value,
      category: e.target.category.value
    }
    console.log(obj);
    axios.post('http://localhost:4000/add-expense', obj)
      .then((response) => {
        showOnScreen(response.data.expense);
      }) 
      .catch(err => console.log(err));
  }

  window.addEventListener('DOMContentLoaded', ()=> {
    axios.get('http://localhost:4000/get-expense')
    .then(response => {
      response.data.expence.forEach(expence => {
        showOnScreen(expence);
      })
    })
  })
  
  function showOnScreen(expense){
    const parentElement = document.getElementById('listOfExpenses');
    const expenseElement = `expense-${expense.id}`;
    parentElement.innerHTML += 
    `<li id = ${expenseElement}>
      ${expense.expenseamount} - ${expense.description} - ${expense.category}
      <button onclick='deleteExpense(event, ${expense.id}'>Delete Expense</button></li> `
  }

  function deleteExpense(e, expenceid){
    axios.delete(`http://localhost:4000/delete-expense/${expenceid}`)
    .then(() => {
      removeFromScreen(expenceid);
    })
    .catch((err) => console.log(err));
  }

  function removeFromScreen(expenceid){
    const expenseElement = `expence-${expenceid}`;
    document.getElementById(expenseElement).remove();
  }
</script>
</body>
</html>